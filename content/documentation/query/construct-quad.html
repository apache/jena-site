<!DOCTYPE html>
<html lang="en">
<head>
    

    <title>Apache Jena - ARQ - Construct Quad</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/css/bootstrap-extension.css" rel="stylesheet" type="text/css">
    <link href="/css/jena.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="/images/favicon.ico" />

    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous"></script>
    <script src="/js/jena-navigation.js" type="text/javascript"></script>
    <script src="/js/bootstrap.min.js" type="text/javascript"></script>

    <script src="/js/improve.js" type="text/javascript"></script>

    
</head>

<body>

<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/index.html">
                <img class="logo-menu" src="/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">Apache Jena</a>
        </div>

        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                <li id="homepage"><a href="/index.html"><span class="glyphicon glyphicon-home"></span> Home</a></li>
                <li id="download"><a href="/download/index.cgi"><span class="glyphicon glyphicon-download-alt"></span> Download</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-book"></span> Learn <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">Tutorials</li>
                        <li><a href="/tutorials/index.html">Overview</a></li>
                        <li><a href="/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                        <li><a href="/tutorials/sparql.html">SPARQL tutorial</a></li>
                        <li><a href="/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                        <li><a href="/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                        <li><a href="/documentation/notes/index.html">How-To's</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-header">References</li>
                        <li><a href="/documentation/index.html">Overview</a></li>
                        <li><a href="/documentation/javadoc.html">Javadoc</a></li>
                        <li><a href="/documentation/rdf/index.html">RDF API</a></li>
                        <li><a href="/documentation/io/">RDF I/O</a></li>
                        <li><a href="/documentation/query/index.html">ARQ (SPARQL)</a></li>
                        <li><a href="/documentation/rdfconnection/">RDF Connection - SPARQL API</a></li>
                        <li><a href="/documentation/tdb/index.html">TDB</a></li>
                        <li><a href="/documentation/tdb2/index.html">TDB2</a></li>
                        <li><a href="/documentation/query/text-query.html">Text Search</a></li>
                        <li><a href="/documentation/shacl/index.html">SHACL</a></li>
                        <li><a href="/documentation/geosparql/index.html">GeoSPARQL</a></li>
                        <li><a href="/documentation/tools/index.html">Command-line tools</a></li>
                        <li><a href="/documentation/hadoop/index.html">Elephas - tools for RDF on Hadoop</a></li>
                        <li><a href="/documentation/jdbc/index.html">SPARQL over JDBC</a></li>
                        <li><a href="/documentation/fuseki2/index.html">Fuseki</a></li>
                        <li><a href="/documentation/permissions/index.html">Permissions</a></li>
                        <li><a href="/documentation/assembler/index.html">Assembler</a></li>
                        <li><a href="/documentation/ontology/">Ontology API</a></li>
                        <li><a href="/documentation/inference/index.html">Inference API</a></li>
                        <li><a href="/documentation/extras/querybuilder/index.html">Query Builder</a></li>
                    </ul>
                </li>

                <li class="drop down">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-book"></span> Javadoc <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/documentation/javadoc/jena/">Jena Core</a></li>
                        <li><a href="/documentation/javadoc/arq/">ARQ</a></li>
                        <li><a href="/documentation/javadoc/tdb/">TDB</a></li>
                        <li><a href="/documentation/javadoc/fuseki2/">Fuseki</a></li>
                        <li><a href="/documentation/javadoc_elephas.html">Elephas</a></li>
                        <li><a href="/documentation/javadoc/text/">Text Search</a></li>
                        <li><a href="/documentation/javadoc/shacl/">SHACL</a></li>
                        <li><a href="/documentation/javadoc/geosparql/">GeoSPARQL</a></li>
                        <li><a href="/documentation/javadoc/permissions/">Permissions</a></li>
                        <li><a href="/documentation/javadoc/jdbc/">JDBC</a></li>
                        <li><a href="/documentation/javadoc/extras/querybuilder/">Query Builder</a></li>
                        <li><a href="/documentation/javadoc.html">All Javadoc</a></li>
                    </ul>
                </li>

                <li id="ask"><a href="/help_and_support/index.html"><span class="glyphicon glyphicon-question-sign"></span> Ask</a></li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-bullhorn"></span> Get involved <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/getting_involved/index.html">Contribute</a></li>
                        <li><a href="/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-header">Project</li>
                        <li><a href="/about_jena/about.html">About Jena</a></li>
                        <li><a href="/about_jena/roadmap.html">Roadmap</a></li>
                        <li><a href="/about_jena/architecture.html">Architecture</a></li>
                        <li><a href="/about_jena/team.html">Project team</a></li>
                        <li><a href="/about_jena/contributions.html">Related projects</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-header">ASF</li>
                        <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                        <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                        <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                        <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                        <li><a href="http://www.apache.org/security/">Security</a></li>
                    </ul>
                </li>

                <li id="edit"><a href="https://github.com/apache/jena-site/edit/master/source/documentation/query/construct-quad.md" title="Edit this page on GitHub"><span class="glyphicon glyphicon-pencil"></span> Edit this page</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div id="breadcrumbs">
                
                    





<ol class="breadcrumb">
    
    
        
        
    
        
        
            
                <li><a href='/documentation'>DOCUMENTATION</a></li>
            
            
        
    
        
        
            
                <li><a href='/documentation/query'>QUERY</a></li>
            
            
        
    
        
        
            
                <li class="active">CONSTRUCT QUAD</li>
            
            
        
    
</ol>




                
            </div>
            <h1 class="title">ARQ - Construct Quad</h1>
            
	<p>The current W3C recommendation of
<a href="http://www.w3.org/TR/sparql11-query/">SPARQL 1.1</a> supports the <a href="http://www.w3.org/TR/sparql11-query/#construct">CONSTRUCT query
form</a>, which returns a single RDF graph specified by a graph template.  The
result is an RDF graph formed by taking each query solution in the solution
sequence, substituting for the variables in the graph template, and
combining the triples into a single RDF graph by set union.  However, it
does not directly generate quads or
<a href="http://www.w3.org/TR/sparql11-query/#rdfDataset">RDF datasets</a>.<br>
In order to
eliminate this limitation, Jena ARQ extends the grammar of the <code>CONSTRUCT</code>
query form and provides the according components, which brings more
conveniences for the users manipulating RDF datasets with SPARQL.</p>
<p>This feature was added in Jena 3.0.1.</p>
<h2 id="query-syntax">Query Syntax</h2>
<p>A <code>CONSTRUCT</code> template of the SPARQL 1.1 query String is
<a href="http://www.w3.org/TR/turtle/">Turtle</a> format with possible variables.  The
syntax for this extension follows that style in ARQ, using
<a href="http://www.w3.org/TR/trig/">TriG</a> plus variables.  Just like SPARQL 1.1,
there are 2 forms for ARQ Construct Quad query:</p>
<h3 id="complete-form">Complete Form</h3>
<pre><code>CONSTRUCT {
    # Named graph
    GRAPH :g { ?s :p ?o }
    # Default graph
    { ?s :p ?o }
    # Default graph
    :s ?p :o
} WHERE { 
    # SPARQL 1.1 WHERE Clause
    ... 
}
</code></pre>
<p>The default graphs and the named graphs can be constructed within the
<code>CONSTRUCT</code> clause in the above way.  Note that, for constructing the named
graph, the token of <code>GRAPH</code> can be optional.  The brackets of the triples to
be constructed in the default graph can also be optional.</p>
<h3 id="short-form">Short Form</h3>
<pre><code>CONSTRUCT WHERE { 
    # Basic dataset pattern (only the default graph and the named graphs)
    ... 
}
</code></pre>
<p>A short form is provided for the case where the template and the pattern
are the same and the pattern is just a basic dataset pattern (no <code>FILTER</code>s
and no complex graph patterns are allowed in the short form). The keyword
<code>WHERE</code> is required in the short form.</p>
<h3 id="grammar">Grammar</h3>
<p>The normative definition of the syntax grammar of the query string is defined in this table:</p>
<table>
<thead>
<tr>
<th>Rule</th>
<th></th>
<th>Expression</th>
</tr>
</thead>
<tbody>
<tr>
<td>ConstructQuery</td>
<td>::=</td>
<td>&lsquo;CONSTRUCT&rsquo; ( ConstructTemplate DatasetClause* WhereClause SolutionModifier | DatasetClause* &lsquo;WHERE&rsquo;  &lsquo;{&rsquo; ConstructQuads &lsquo;}&rsquo; SolutionModifier )</td>
</tr>
<tr>
<td>ConstructTemplate</td>
<td>::=</td>
<td>&lsquo;{&rsquo; ConstructQuads &lsquo;}&rsquo;</td>
</tr>
<tr>
<td>ConstructQuads</td>
<td>::=</td>
<td>TriplesTemplate? ( ConstructQuadsNotTriples &lsquo;.'? TriplesTemplate? )*</td>
</tr>
<tr>
<td>ConstructQuadsNotTriples</td>
<td>::=</td>
<td>( &lsquo;GRAPH&rsquo;  VarOrBlankNodeIri )? &lsquo;{&rsquo; TriplesTemplate? &lsquo;}&rsquo;</td>
</tr>
<tr>
<td>TriplesTemplate</td>
<td>::=</td>
<td>TriplesSameSubject ( &lsquo;.&rsquo; TriplesTemplate? )?</td>
</tr>
</tbody>
</table>
<p><code>DatasetClause</code>, <code>WhereClause</code>, <code>SolutionModifier</code>, <code>TriplesTemplate</code>, <code>VarOrIri</code>,
<code>TriplesSameSubject</code> are as for the <a href="http://www.w3.org/TR/sparql11-query/#grammar">SPARQL 1.1 Grammar</a></p>
<h2 id="programming-api">Programming API</h2>
<p>ARQ provides 2 additional methods in <a href="/documentation/javadoc/arq/org/apache/jena/query/QueryExecution.html">QueryExecution</a> for Construct Quad.</p>
<pre><code>Iterator&lt;Quad&gt; QueryExecution.execConstructQuads() // allow duplication
Dataset QueryExecution.execConstructDataset() // no duplication
</code></pre>
<p>One difference of the 2 methods is:
The method of <code>execConstructQuads()</code> returns an <code>Iterator</code> of <code>Quad</code>, allowing duplication.
But <code>execConstructDataset()</code> constructs the desired Dataset object with only unique <code>Quad</code>s.</p>
<p>In order to use these methods, it&rsquo;s required to switch on the query syntax
of ARQ beforehand, when creating the <code>Query</code> object:</p>
<pre><code>Query query = QueryFactory.create(queryString, Syntax.syntaxARQ);
</code></pre>
<p>If the query is supposed to construct only triples, not quads, the triples
will be constructed in the default graph. For example:</p>
<pre><code>String queryString = &quot;CONSTRUCT { ?s ?p ?o } WHERE ... &quot;
...
// The graph node of the quads are the default graph (ARQ uses &lt;urn:x-arq:DefaultGraphNode&gt;).
Iterator&lt;Quad&gt; quads = qexec.execConstructQuads(); 
</code></pre>
<p>If the query string stands for constructing quads while the method of
<code>exeConstructTriples()</code> are called, it returns only the triples in the
default graph of the <code>CONSTRUCT</code> query template. It&rsquo;s called a &ldquo;projection&rdquo;
on the default graph. For instance:</p>
<pre><code>String queryString = &quot;CONSTRUCT { ?s ?p ?o . GRAPH ?g1 { ?s1 ?p1 ?o1 } } WHERE ...&quot;
...
// The part of &quot;GRAPH ?g1 { ?s1 ?p1 ?o1 }&quot; will be ignored. Only &quot;?s ?p ?o&quot; in the default graph will be returned.
Iterator&lt;Triple&gt; triples = qexec.execConstructTriples();
</code></pre>
<p>More examples can be found at <code>ExampleConstructQuads.java</code> under <code>jena-arq/src-examples</code></p>
<h2 id="fuseki-support">Fuseki Support</h2>
<p>Jena <a href="/documentation/fuseki2/index.html">Fuseki</a> is also empowered with Construct Quad query as a built-in
function. No more additional configuration is required to switch it on.
Because
<a href="/documentation/javadoc/arq/org/apache/jena/sparql/engine/http/QueryEngineHTTP.html">QueryEngineHTTP</a>
is just an implementation of QueryExecution, there&rsquo;s no much difference
for the client users to manipulate the programming API described in the
previous sections, e.g.</p>
<pre><code>String queryString = &quot; CONSTRUCT { GRAPH &lt;http://example/ns#g1&gt; {?s ?p ?o} } WHERE {?s ?p ?o}&quot; ;
Query query = QueryFactory.create(queryString, Syntax.syntaxARQ);
try ( QueryExecution qExec = QueryExecutionFactory.sparqlService(serviceQuery, query) ) { // serviceQuery is the URL of the remote service
    Iterator&lt;Quad&gt; result = qExec.execConstructQuads();
    ...
}
...
</code></pre>
<p><a href="index.html">ARQ documentation index</a></p>


        </div>
    </div>

</div>

<footer class="footer">
    <div class="container">
        <p>
            Copyright &copy; 2011&ndash;2020 The Apache Software Foundation, Licensed under the
            <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
            Apache Jena, Jena, the Apache Jena project logo, Apache and the Apache feather logos are trademarks of
            The Apache Software Foundation.
        </p>
    </div>
</footer>


<script type="text/javascript">
    var link = $('a[href="' + this.location.pathname + '"]');
    if (link != undefined)
        link.parents('li,ul').addClass('active');
</script>

</body>
</html>
